# 탈출쯔꾸르 (Escape Zzuggur)

**영문 제목 제안**

* Escape Zzuggur
* Zzuggur: Office Escape
* Project Zzuggur

장르: 탑다운 쯔꾸르 스타일 / 방탈출 / 미니퍼즐
플레이타임: 약 8~10분
플랫폼: Web (React / Phaser 등)

---

## 1. 게임 스토리

플레이어는 어느 날 밤, 텅 빈 사무실 건물 안에서 눈을 뜬다.
출입문은 잠겨 있고, 메인홀 중앙에는 잠금 상자가 하나 놓여 있다.

> 시스템: “출입문은 잠겨 있다.”
> 시스템: “어딘가에 열쇠가 있을 것 같다.”

건물 안의 각 방에는 이전 근무자들이 남긴 장치와 퍼즐이 있고,
이를 하나씩 해결해 숫자 메모를 모아야만 상자를 열 수 있다.

모든 것은 과하게 심각하지 않되, 어딘가 묘하게 불길한 분위기를 유지한다.

---

## 2. 게임 전체 진행 텍스트 흐름

### 게임 시작

* "……여긴 어디지?"
* "회사 맞는 것 같은데, 아무도 없네."
* "일단 나갈 방법부터 찾아보자."

### 메인홀 최초 진입

* "문이 잠겨 있다."
* "상자에 숫자 입력 장치가 달려 있다."

### 방 진입 공통 텍스트

* "이 방에도 뭔가 있을 것 같다."

### 숫자 메모 획득 시

* "메모를 발견했다. 숫자가 적혀 있다."

### 모든 숫자 획득 후

* "이제 상자를 열 수 있을 것 같다."

### 엔딩 텍스트

(엔딩 분기는 아래 항목 참조)

---

## 3. 게임 진행 방식 및 클리어 조건

### 기본 진행 방식

1. 메인홀에서 각 방으로 자유 이동
2. 방 안의 특정 오브젝트에 닿으면 미니퍼즐 시작
3. 미니퍼즐은 전체 화면으로 전환되어 단독 진행
4. 클리어 시 숫자 메모 1개 획득
5. 숫자 3개를 모두 모아 메인홀 상자 해금
6. 열쇠 획득 후 출입문으로 이동 → 클리어

### 실패 처리

* 미니퍼즐 실패 시 즉시 재도전 가능
* 게임 오버 없음

---

## 4. 엔딩 분기

### Happy Ending (완전 탈출)

**조건**: 모든 미니퍼즐 클리어 후 탈출

* 텍스트: "문이 열린다. 밖의 공기가 느껴진다. 오늘 야근은 여기까지다."

### Neutral Ending (대충 탈출)

**조건**: 힌트 확인 후 최소 정보만으로 탈출 (선택 요소)

* 텍스트: "나오긴 했지만… 뭔가 찜찜하다."

### Bad Ending (포기)

**조건**: 일정 시간 경과 후 포기 선택

* 텍스트: "불이 꺼진다. 내일도 출근일지도 모른다."

---

## 5. 전체 맵 구조

### 메인홀 (중앙 허브)

* 출입문 (게임 클리어 지점)
* 숫자 입력 상자 (최종 퍼즐)
* 각 방으로 이어지는 문 3개

연결 구조:

* 메인홀 → 회의실
* 메인홀 → 창고
* 메인홀 → 서버실

---

## 6. 방별 구성 및 트리거 오브젝트

### 1) 회의실

* 구성: 테이블, 의자, 화이트보드
* 트리거 오브젝트: 회의 자료가 쌓인 서류 더미

### 2) 창고

* 구성: 박스, 철제 선반
* 트리거 오브젝트: 잠긴 상자

### 3) 서버실

* 구성: 서버랙, 모니터
* 트리거 오브젝트: 켜진 단말기

---

## 7. 미니퍼즐 상세 스펙

### 미니퍼즐 A – 패턴 기억 퍼즐 (회의실)

* 화면: 3×3 패널
* 규칙:

  1. 일부 패널이 1초간 점등
  2. 전부 꺼짐
  3. 플레이어가 같은 패턴 클릭
* 성공 조건: 패턴 완전 일치
* 실패 조건: 오입력
* 보상: 숫자 메모 1개

---

### 미니퍼즐 B – 타이밍 퍼즐 (창고)

* 화면: 가로 바 + 이동 포인터
* 규칙:

  1. 포인터 자동 이동
  2. 버튼 1회 입력으로 정지
* 성공 조건: 성공 영역 안에서 정지
* 보상: 숫자 메모 1개

---

### 미니퍼즐 C – 순서 추론 퍼즐 (서버실)

* 화면: 버튼 3개 + 힌트 문장
* 규칙:

  1. 힌트 문장 제시
  2. 버튼 3개를 순서대로 클릭
* 성공 조건: 올바른 순서 입력
* 보상: 숫자 메모 1개

---

## 8. 최종 상자 퍼즐

* 입력 방식: 숫자 3자리 입력
* 숫자 순서는 미니퍼즐 클리어 순서 또는 힌트 기반
* 성공 시: 열쇠 등장

---

## 9. 조작 방식 (Controls)

### 플랫폼별 조작 방식

#### 모바일 (Touch)

* **Fixed Virtual Joystick** 사용
* 위치: 화면 좌측 하단
* 구성:

  * 외곽 원: 조작 범위
  * 내부 스틱: 드래그 방향/거리 기준 이동
* 이동 방식:

  * 드래그 방향 → 캐릭터 이동 방향
  * 드래그 거리 → 이동 속도 (아날로그)

> UI 표기 예: 반투명 원형 조이스틱

#### PC (Keyboard)

* 키보드 입력 기반 이동

* 기본 키 매핑:

  * W / ↑ : 위로 이동
  * S / ↓ : 아래로 이동
  * A / ← : 왼쪽 이동
  * D / → : 오른쪽 이동

* 이동 방식:

  * 4방향 또는 8방향 이동 (구현 선택)

#### 공통 규칙

* 모바일 / PC 모두 **동일한 이동 로직** 사용
* 입력 방식만 추상화하여 분기 처리

---

## 10. 개발 시 유의사항

* 모든 방과 미니퍼즐은 Scene 단위 분리 권장
* 미니퍼즐은 단독 상태 관리
* 탐험 파트와 퍼즐 파트 로직 완전 분리

---

이 문서는 바로 개발에 착수할 수 있는 1차 기획서 역할을 한다.


### 개발 

## 개발 계획 및 진행 상황

### 전체 개발 흐름

1. **프로젝트 기본 구조 설정** (1단계)
   - EscapePage.tsx 및 기본 라우팅 설정
   - 게임 데이터 타입 정의
   - 씬 기본 구조 생성

2. **탐험 시스템 구현** (2단계)
   - 메인 탐험 씬 (맵 렌더링)
   - 캐릭터 생성 및 기본 이동
   - 입력 시스템 (조이스틱/키보드)

3. **방 이동 시스템** (3단계)
   - 방 전환 로직
   - 각 방 씬 생성 (메인홀, 회의실, 창고, 서버실)
   - 문 상호작용

4. **미니퍼즐 시스템** (4단계)
   - 미니퍼즐 씬 기본 구조
   - 패턴 기억 퍼즐 (회의실)
   - 타이밍 퍼즐 (창고)
   - 순서 추론 퍼즐 (서버실)

5. **게임 플로우 연결** (5단계)
   - 트리거 오브젝트 상호작용
   - 숫자 메모 수집 시스템
   - 최종 상자 퍼즐

6. **엔딩 및 마무리** (6단계)
   - 엔딩 씬
   - 게임 상태 관리
   - UI/UX 개선

---

## TODO 리스트

### ✅ Phase 1: 프로젝트 기본 구조

- [x] **1.1** `src/games/escape/EscapePage.tsx` 생성
  - GamePage 래퍼 사용
  - 기본 씬 연결

- [x] **1.2** `src/app/router.tsx`에 escape 게임 라우트 추가
  - `/escape` 경로 추가
  - GameHub에 게임 목록에 표시

- [x] **1.3** `src/games/escape/types.ts` 생성
  - `RoomId` 타입 (메인홀, 회의실, 창고, 서버실)
  - `GameState` 인터페이스 (숫자 메모, 열쇠 보유 상태)
  - 기본 타입 정의

- [x] **1.4** `src/games/escape/data/rooms.ts` 생성
  - 방별 설정 데이터
  - 문 위치 및 연결 정보

- [x] **1.5** 기본 씬 파일 생성 (빈 구조)
  - `ExplorationScene.ts` (메인 탐험 씬)
  - `MainHallScene.ts` (메인홀)
  - `MeetingRoomScene.ts` (회의실)
  - `StorageRoomScene.ts` (창고)
  - `ServerRoomScene.ts` (서버실)

---

### ⏳ Phase 2: 탐험 시스템 구현

- [x] **2.1** `ExplorationScene.ts` - 기본 맵 렌더링
  - 배경 타일맵 또는 단색 배경
  - 방 구조 표시 (간단한 Rectangle로 구현 가능)

- [x] **2.2** `ExplorationScene.ts` - 캐릭터 생성
  - 플레이어 스프라이트 (Rectangle 또는 Circle)
  - 초기 위치 설정

- [x] **2.3** 입력 시스템 - 키보드 입력
  - `WASD` / 방향키 입력 감지
  - 4방향 또는 8방향 이동 처리

- [ ] **2.4** 입력 시스템 - 모바일 조이스틱
  - `systems/VirtualJoystick.ts` 생성
  - 화면 좌측 하단에 고정된 원형 조이스틱 UI
  - **동작 방식**:
    - 조이스틱 배경 원(Outer Circle)은 고정 위치
    - 중앙 스틱(Inner Stick)을 터치하면 입력 시작
    - 터치 지점에서 드래그 방향 벡터 계산
    - 드래그 방향 → 이동 방향
    - 드래그 거리(최대 반경 기준) → 이동 속도 (아날로그)
    - 터치 해제(pointer up) 시 이동 즉시 중단
  - ⚠️ 특정 좌표 클릭 이동 방식이 아님
  - ⚠️ 항상 드래그 기반 아날로그 이동

- [x] **2.5** 캐릭터 이동 로직
  - 물리 기반 이동 (velocity 적용)
  - 맵 경계 충돌 처리
  - 이동 애니메이션 (옵션)

---

### ⏳ Phase 3: 방 이동 시스템

- [ ] **3.1** 방 데이터 구조 설계
  - 각 방의 크기, 출입구 위치
  - 오브젝트 배치 정보

- [ ] **3.2** 문 상호작용 시스템
  - 문 근처 접근 시 상호작용 표시
  - 클릭/터치로 방 이동
  - 씬 전환 로직 (`scene.start()`)

- [ ] **3.3** `MainHallScene.ts` 구현
  - 메인홀 배경 및 오브젝트 (출입문, 상자)
  - 3개 방으로 가는 문 배치
  - 상자 상호작용 (숫자 입력 UI는 나중에)

- [ ] **3.4** `MeetingRoomScene.ts` 구현
  - 회의실 배경 및 오브젝트 (테이블, 의자, 화이트보드)
  - 서류 더미 트리거 오브젝트 배치

- [ ] **3.5** `StorageRoomScene.ts` 구현
  - 창고 배경 및 오브젝트 (박스, 선반)
  - 잠긴 상자 트리거 오브젝트 배치

- [ ] **3.6** `ServerRoomScene.ts` 구현
  - 서버실 배경 및 오브젝트 (서버랙, 모니터)
  - 켜진 단말기 트리거 오브젝트 배치

---

### ⏳ Phase 4: 미니퍼즐 시스템

- [ ] **4.1** 미니퍼즐 씬 기본 구조
  - `puzzle/PatternPuzzleScene.ts` (패턴 기억)
  - `puzzle/TimingPuzzleScene.ts` (타이밍)
  - `puzzle/SequencePuzzleScene.ts` (순서 추론)
  - 공통 인터페이스 (성공/실패 콜백)

- [ ] **4.2** `PatternPuzzleScene.ts` - 패턴 기억 퍼즐
  - 3×3 패널 생성
  - 패턴 점등 로직 (1초간 표시)
  - 플레이어 입력 처리
  - 성공/실패 판정

- [ ] **3.3** `TimingPuzzleScene.ts` - 타이밍 퍼즐
  - 가로 바 UI 생성
  - 포인터 자동 이동 로직
  - 성공 영역 표시
  - 버튼 클릭 시 정지 및 판정

- [ ] **4.4** `SequencePuzzleScene.ts` - 순서 추론 퍼즐
  - 힌트 문장 표시
  - 3개 버튼 생성
  - 순서 입력 로직
  - 성공/실패 판정

- [ ] **4.5** 미니퍼즐 통합
  - 탐험 씬에서 트리거 오브젝트 클릭 시 퍼즐 씬 시작
  - 퍼즐 클리어 시 숫자 메모 획득
  - 게임 상태에 숫자 메모 저장
  - 퍼즐 실패 시 재도전 가능

---

### ⏳ Phase 5: 게임 플로우 연결

- [ ] **5.1** 게임 상태 관리 시스템
  - `GameState` 싱글톤 또는 씬 간 데이터 전달
  - 획득한 숫자 메모 저장 (배열 또는 Set)
  - 열쇠 보유 상태 관리

- [ ] **5.2** 트리거 오브젝트 상호작용
  - 오브젝트 근처 접근 감지
  - 상호작용 가능 표시 (UI 힌트)
  - 클릭/터치 시 퍼즐 씬 시작
  - 이미 클리어한 퍼즐은 재시작 불가 (옵션)

- [ ] **5.3** 숫자 메모 획득 시스템
  - 퍼즐 클리어 시 숫자 메모 추가
  - UI에 획득한 숫자 표시 (옵션)
  - 숫자 메모 데이터 구조 (순서 정보 포함)

- [ ] **5.4** 최종 상자 퍼즐 구현
  - 상자 상호작용 시 숫자 입력 UI 표시
  - 3자리 숫자 입력 처리
  - 숫자 순서 검증 로직
  - 성공 시 열쇠 획득 애니메이션

- [ ] **5.5** 출입문 클리어 처리
  - 열쇠 보유 상태 확인
  - 출입문 상호작용 시 엔딩 씬으로 전환

---

### ⏳ Phase 6: 엔딩 및 마무리

- [ ] **6.1** `EndingScene.ts` 생성
  - 엔딩 텍스트 표시
  - 엔딩 분기 처리 (Happy/Neutral/Bad)
  - 게임 재시작 또는 메인화면 복귀 버튼

- [ ] **6.2** 대화 시스템 (옵션)
  - 게임 시작 시 대화 표시
  - 방 진입 시 대화 표시
  - 대화 UI 컴포넌트

- [ ] **6.3** UI/UX 개선
  - 획득한 숫자 메모 표시 (상단 UI)
  - 상호작용 가능 오브젝트 하이라이트
  - 조이스틱 시각적 개선
  - 전환 애니메이션

- [ ] **6.4** 테스트 및 버그 수정
  - 각 방 이동 테스트
  - 모든 퍼즐 동작 테스트
  - 게임 플로우 전체 테스트
  - 모바일/PC 입력 테스트

---

## 개발 시 참고사항

### 기술 스택
- **게임 엔진**: Phaser 3
- **씬 구조**: 각 방과 퍼즐은 별도 Scene으로 분리
- **상태 관리**: Phaser Scene 간 데이터 전달 (`scene.start()`의 `data` 파라미터 활용)
- **입력 시스템**: PC는 키보드, 모바일은 가상 조이스틱 (공통 이동 로직 사용)

### Virtual Joystick (모바일 이동 컨트롤) 구현 상세

**개요**
- 모바일 환경에서 캐릭터 이동은 Fixed Virtual Joystick 방식 사용
- 화면 좌측 하단에 고정된 원형 조이스틱 UI
- 사용자가 조이스틱을 터치 후 드래그하면 캐릭터가 해당 방향으로 이동

**동작 방식 (중요)**
1. 조이스틱 배경 원(Outer Circle)은 고정 위치
2. 중앙 스틱(Inner Stick)을 터치하면 입력 시작
3. 터치 지점에서 드래그 방향 벡터 계산
4. 드래그 방향 → 이동 방향
5. 드래그 거리(최대 반경 기준) → 이동 속도 (아날로그)
6. 터치 해제(pointer up) 시 이동 즉시 중단

**⚠️ 주의사항**
- 특정 좌표 클릭 이동 방식이 아님
- 항상 드래그 기반 아날로그 이동

### 구현 우선순위
1. 먼저 PC 키보드 입력으로 기본 탐험 가능하게 만들기
2. 조이스틱은 나중에 추가해도 됨
3. 그래픽은 최소한으로 (Rectangle, Circle 등으로 충분)
4. 게임 플로우가 완성되면 시각적 개선

### 파일 구조 예시
```
src/games/escape/
├── EscapePage.tsx
├── types.ts
├── data/
│   └── rooms.ts
├── scene/
│   ├── ExplorationScene.ts
│   ├── MeetingRoomScene.ts
│   ├── StorageRoomScene.ts
│   └── ServerRoomScene.ts
├── puzzle/
│   ├── PatternPuzzleScene.ts
│   ├── TimingPuzzleScene.ts
│   └── SequencePuzzleScene.ts
├── systems/
│   └── VirtualJoystick.ts
└── EndingScene.ts
```

---

**시작 순서**: Phase 1부터 순차적으로 진행